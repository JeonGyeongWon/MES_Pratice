<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="User">

	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap" />
	<typeAlias alias="userSearchVO" type="egovframework.let.uss.umt.service.UserDefaultVO" />
	<typeAlias alias="userVO" type="egovframework.let.uss.umt.service.UserManageVO" />

	<select id="userManageDAO.selectUserList_S" parameterClass="userSearchVO" resultClass="egovMap">
		SELECT *
		  FROM (SELECT rownum rn, TB.*
		          FROM (SELECT ESNTL_ID as "uniqId",
			                       'USR03' as "userTy",
			                       EMPLYR_ID as "userId",
			                       USER_NM as "userNm",
			                       '111' as "emailAdres",
			                       '111' as "offmTelno",
			                       AREA_NO as "areaNo",
			                       HOUSE_MIDDLE_TELNO as "middleTelno",
			                       HOUSE_END_TELNO as "endTelno",
			                       MBTLNUM as "moblphonNo",
			                       GROUP_ID as "groupId",
			                       EMPLYR_STTUS_CODE as "sttus",
			                       SBSCRB_DE as "sbscrbDe",
			                       -1 as "vendorSiteId"
			                  FROM LETTNEMPLYRINFO a
			                 WHERE 1 = 1
		<isNotEqual prepend="AND" property="sbscrbSttus" compareValue="0">
			EMPLYR_STTUS_CODE LIKE #sbscrbSttus#
		</isNotEqual>
		<isEqual prepend="AND" property="searchCondition" compareValue="0">
			EMPLYR_ID LIKE #searchKeyword#
		</isEqual>
		<isEqual prepend="AND" property="searchCondition" compareValue="1">
			USER_NM LIKE '%' ||#searchKeyword#|| '%'
		</isEqual>
		ORDER BY EMPLYR_ID
		) TB ) WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
	</select>

	<select id="userManageDAO.selectUserListTotCnt_S" parameterClass="userSearchVO" resultClass="int">
		SELECT COUNT(1) totcnt
		  FROM LETTNEMPLYRINFO
		 WHERE 1=1
		<isNotEqual prepend="AND" property="sbscrbSttus" compareValue="0">
			EMPLYR_STTUS_CODE LIKE #sbscrbSttus#
		</isNotEqual>
		<isEqual prepend="AND" property="searchCondition" compareValue="0">
			EMPLYR_ID LIKE #searchKeyword#
		</isEqual>
		<isEqual prepend="AND" property="searchCondition" compareValue="1">
			USER_NM LIKE '%' ||#searchKeyword#|| '%'
		</isEqual>
	</select>

	<select id="userManageDAO.selectErpUserList_S" parameterClass="userSearchVO" resultClass="egovMap">
		SELECT *
		  FROM (SELECT rownum rn, TB.*
		          FROM (SELECT vendor_Id as "vendorId",
		                       vendor_Site_Id as "vendorSiteId",
		                       '' as "vendorName",
		                       '' as "vendorSiteName",
		                       offm_Telno as "offmTelno",
		                       '' AS "registNum",
		                       EMPLYR_ID as "userId"
		                  FROM LETTNEMPLYRINFO B
		                 ORDER BY 3 DESC) TB)
		 WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
	</select>

	<select id="userManageDAO.selectErpUserListTotCnt_S" parameterClass="userSearchVO" resultClass="int">
		SELECT COUNT(1) totcnt
		FROM
		LETTNEMPLYRINFO B
	</select>
	
	<select id="userManageDAO.selectCarUserList_S" parameterClass="userSearchVO" resultClass="egovMap">
		SELECT *
		  FROM (SELECT rownum rn, TB.*
			          FROM (SELECT *
				                  FROM (SELECT '' AS "vendorId",
					                               papf.employee_number as "vendorSiteId",
					                               apps.cbgl_common_pkg.cbgl_get_segment_name_coa(101,
					                                                                              'SEGMENT2',
					                                                                              gcc.segment2) as "vendorName",
					                               papf.last_name as "vendorSiteName",
					                               (select max(phone_number) TEL
					                                  from APPS.per_phones phn
					                                 where phn.parent_id = papf.person_id
					                                   and phn.parent_table = 'PER_ALL_PEOPLE_F'
					                                   and phn.phone_type = 'W1') as "offmTelno",
					                               '' AS "registNum"
					                          FROM apps.per_all_people_f      papf,
						                               apps.per_all_assignments_f paaf,
						                               apps.gl_code_combinations  gcc
					                         WHERE 1 = 1
					                           AND papf.person_id = paaf.person_id
					                           AND paaf.default_code_comb_id = gcc.code_combination_id
		<isNotEmpty property="searchKeyword">
			AND papf.last_name LIKE '%' || #searchKeyword# || '%'
		</isNotEmpty>
		UNION ALL
		SELECT vendor_Id as "vendorId",
		       vendor_Site_Id as "vendorSiteId",
		       '' as "vendorName",
		       '' as "vendorSiteName",
		       offm_Telno as "offmTelno",
		       '' AS "registNum"
		  FROM LETTNEMPLYRINFO B
		 WHERE 1 = 1
		
		 ) A
		 ORDER BY "vendorSiteId"
		
		) TB)
		 WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
	</select>

	<select id="userManageDAO.selectCarUserListTotCnt_S" parameterClass="userSearchVO" resultClass="int">
		SELECT count(*)
		  FROM (SELECT '' AS "vendorId",
			               papf.employee_number as "vendorSiteId",
			               apps.cbgl_common_pkg.cbgl_get_segment_name_coa(101,
			                                                              'SEGMENT2',
			                                                              gcc.segment2) as "vendorName",
			               papf.last_name as "vendorSiteName",
			               (select max(phone_number) TEL
			                  from APPS.per_phones phn
			                 where phn.parent_id = papf.person_id
			                   and phn.parent_table = 'PER_ALL_PEOPLE_F'
			                   and phn.phone_type = 'W1') as "offmTelno",
			               '' AS "registNum"
			          FROM apps.per_all_people_f      papf,
			               apps.per_all_assignments_f paaf,
			               apps.gl_code_combinations  gcc
			         WHERE 1 = 1
			           AND papf.person_id = paaf.person_id
			           AND paaf.default_code_comb_id = gcc.code_combination_id
			        UNION ALL
			        SELECT vendor_Id as "vendorId",
			               vendor_Site_Id as "vendorSiteId",
			               '' as "vendorName",
			               '' as "vendorSiteName",
			               offm_Telno as "offmTelno",
			               '' AS "registNum"
			          FROM LETTNEMPLYRINFO B
			         WHERE 1 = 1) A
	</select>

	<select id="userManageDAO.userSeq" resultClass="java.lang.String">
		SELECT LPAD(cbosp_LETTNEMPLYRINFO_s.NEXTVAL,4,'0') FROM DUAL
	</select>

	<insert id="userManageDAO.insertUser_S">
        <![CDATA[
           INSERT INTO LETTNEMPLYRINFO
			  (ESNTL_ID,
			   EMPLYR_ID,
			   VENDOR_ID,
			   VENDOR_SITE_ID,
			   USER_NM,
			   PASSWORD,
			   PASSWORD_HINT,
			   PASSWORD_CNSR,
			   EMPL_NO,
			   IHIDNUM,
			   SEXDSTN_CODE,
			   BRTHDY,
			   AREA_NO,
			   HOUSE_MIDDLE_TELNO,
			   HOUSE_END_TELNO,
			   FXNUM,
			   HOUSE_ADRES,
			   DETAIL_ADRES,
			   ZIP,
			   OFFM_TELNO,
			   MBTLNUM,
			   EMAIL_ADRES,
			   OFCPS_NM,
			   GROUP_ID,
			   ORGNZT_ID,
			   PSTINST_CODE,
			   EMPLYR_STTUS_CODE,
			   SBSCRB_DE,
			   CRTFC_DN_VALUE)
			VALUES
			  (#uniqId#,
			   #emplyrId#,
			   #vendorId#,
			   #vendorSiteId#,
			   #emplyrNm#,
			   #password#,
			   #passwordHint#,
			   #passwordCnsr#,
			   #emplNo#,
			   #ihidnum#,
			   #sexdstnCode#,
			   #brth#,
			   #areaNo#,
			   #homemiddleTelno#,
			   #homeendTelno#,
			   #fxnum#,
			   #homeadres#,
			   #detailAdres#,
			   #zip#,
			   #offmTelno#,
			   #moblphonNo#,
			   #emailAdres#,
			   #ofcpsNm#,
			   #groupId#,
			   #orgnztId#,
			   #insttCode#,
			   #emplyrSttusCode#,
			   sysdate,
			   #subDn#)
        ]]>
	</insert>

	<delete id="userManageDAO.deleteUser_S">
        <![CDATA[
            DELETE FROM LETTNEMPLYRINFO 
            WHERE ESNTL_ID=#delId#
        ]]>
	</delete>

	<select id="userManageDAO.selectUser_S" resultClass="userVO">
        <![CDATA[
            SELECT ESNTL_ID uniqId,
			       'USR03' userTy,
			       EMPLYR_ID emplyrId,
			       USER_NM emplyrNm,
			       PASSWORD password,
			       PASSWORD_HINT passwordHint,
			       PASSWORD_CNSR passwordCnsr,
			       EMPL_NO emplNo,
			       IHIDNUM ihidnum,
			       SEXDSTN_CODE sexdstnCode,
			       BRTHDY brth,
			       AREA_NO areaNo,
			       HOUSE_MIDDLE_TELNO homemiddleTelno,
			       HOUSE_END_TELNO homeendTelno,
			       FXNUM fxnum,
			       HOUSE_ADRES homeadres,
			       DETAIL_ADRES detailAdres,
			       MBTLNUM moblphonNo,
			       EMAIL_ADRES emailAdres,
			       OFCPS_NM ofcpsNm,
			       GROUP_ID groupId,
			       ORGNZT_ID orgnztId,
			       PSTINST_CODE insttCode,
			       EMPLYR_STTUS_CODE emplyrSttusCode,
			       SBSCRB_DE sbscrbDe,
			       CRTFC_DN_VALUE subDn,
			       -1 vendorId,
			       -1 vendorSiteId,
			       '' vendorName,
			       '' vendorSiteName,
			       '' registNum,
			       A.OFFM_TELNO offmTelno,
			       '' zip,
			       '' leader,
			       '' addr1,
			       '' addr2,
			       '' fax,
			       '' email
			  FROM LETTNEMPLYRINFO a
			 WHERE 1 = 1
			   AND ESNTL_ID = #uniqId#
        ]]>
	</select>

	<update id="userManageDAO.updateUser_S">
        <![CDATA[
            UPDATE LETTNEMPLYRINFO
			   SET EMPLYR_ID          = #emplyrId#,
			       USER_NM            = #emplyrNm#,
			       PASSWORD_HINT      = #passwordHint#,
			       PASSWORD_CNSR      = #passwordCnsr#,
			       EMPL_NO            = #emplNo#,
			       IHIDNUM            = #ihidnum#,
			       SEXDSTN_CODE       = #sexdstnCode#,
			       BRTHDY             = #brth#,
			       AREA_NO            = #areaNo#,
			       HOUSE_MIDDLE_TELNO = #homemiddleTelno#,
			       HOUSE_END_TELNO    = #homeendTelno#,
			       FXNUM              = #fxnum#,
			       HOUSE_ADRES        = #homeadres#,
			       DETAIL_ADRES       = #detailAdres#,
			       ZIP                = #zip#,
			       OFFM_TELNO         = #offmTelno#,
			       MBTLNUM            = #moblphonNo#,
			       EMAIL_ADRES        = #emailAdres#,
			       OFCPS_NM           = #ofcpsNm#,
			       GROUP_ID           = #groupId#,
			       ORGNZT_ID          = #orgnztId#,
			       PSTINST_CODE       = #insttCode#,
			       EMPLYR_STTUS_CODE  = #emplyrSttusCode#,
			       CRTFC_DN_VALUE     = #subDn#
			 WHERE ESNTL_ID = #uniqId#
        ]]>
	</update>

	<insert id="userManageDAO.insertUserHistory_S">
        <![CDATA[
            INSERT INTO LETTHEMPLYRINFOCHANGEDTLS
			  (EMPLYR_ID,
			   EMPL_NO,
			   SEXDSTN_CODE,
			   BRTHDY,
			   AREA_NO,
			   HOUSE_MIDDLE_TELNO,
			   HOUSE_END_TELNO,
			   FXNUM,
			   HOUSE_ADRES,
			   DETAIL_ADRES,
			   ZIP,
			   OFFM_TELNO,
			   MBTLNUM,
			   EMAIL_ADRES,
			   GROUP_ID,
			   ORGNZT_ID,
			   PSTINST_CODE,
			   EMPLYR_STTUS_CODE,
			   ESNTL_ID,
			   CHANGE_DE)
			  SELECT EMPLYR_ID,
			         EMPL_NO,
			         SEXDSTN_CODE,
			         BRTHDY,
			         AREA_NO,
			         HOUSE_MIDDLE_TELNO,
			         HOUSE_END_TELNO,
			         FXNUM,
			         HOUSE_ADRES,
			         DETAIL_ADRES,
			         ZIP,
			         OFFM_TELNO,
			         MBTLNUM,
			         EMAIL_ADRES,
			         GROUP_ID,
			         ORGNZT_ID,
			         PSTINST_CODE,
			         EMPLYR_STTUS_CODE,
			         ESNTL_ID,
			         SYSDATE
			    FROM LETTNEMPLYRINFO
			   WHERE ESNTL_ID = #uniqId#
        ]]>
	</insert>

	<select id="userManageDAO.checkIdDplct_S" resultClass="int">
        <![CDATA[
            SELECT COUNT(1) usedCnt
			  FROM (SELECT EMPLYR_ID userId
			          FROM LETTNEMPLYRINFO
			        UNION ALL
			        SELECT ENTRPRS_MBER_ID userId
			          FROM LETTNENTRPRSMBER
			        UNION ALL
			        SELECT MBER_ID userId FROM LETTNGNRLMBER) A
			 WHERE userId = #checkId#
        ]]>
	</select>

	<update id="userManageDAO.updatePassword_S">
        <![CDATA[
            UPDATE LETTNEMPLYRINFO
                 SET PASSWORD = #password#
             WHERE ESNTL_ID = #uniqId#
        ]]>
	</update>

	<select id="userManageDAO.selectPassword_S" resultClass="userVO">
        <![CDATA[
            SELECT PASSWORD password
             FROM LETTNEMPLYRINFO
            WHERE ESNTL_ID = #uniqId#
        ]]>
	</select>

	<select id="userManageDAO.selectUserGroup_S" parameterClass="java.util.Map" resultClass="String">
        <![CDATA[
            SELECT les.AUTHOR_CODE CODE
              FROM LETTNEMPLYRINFO le
              LEFT JOIN LETTNEMPLYRSCRTYESTBS les
                ON (les.scrty_dtrmn_trget_id = le.esntl_id)
             WHERE 1 = 1
               AND le.EMPLYR_ID = #uniqId#
        ]]>
	</select>
</sqlMap>